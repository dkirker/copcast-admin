<div class="container">
  <h2 class="page-header hrDarker" translate>Create User</h2>

  <form novalidate ng-submit="submittted = true" name="frm">
    <div ng-show="serverMessage" class="alert alert-danger">
      <p>
        {{serverMessage}}
      </p>
    </div>

    <div class="row">
      <div class="col-md-4">
        <label for="inputName" translate>Name:</label>
        <input type="text" class="form-control" id="inputName" ng-model="user.name" required/>
      </div>

      <div class="col-md-4">
        <label for="inputUsername" translate>Username:</label>
        <input type="text" class="form-control" id="inputUsername" ng-model="user.username" required/>
      </div>

      <div class="col-md-4">
        <label for="inputEmail" translate>Email:</label>
        <input type="text" class="form-control" id="inputEmail" ng-model="user.email" required/>
      </div>
    </div>

    <br>

    <div class="row">
      <div class="col-md-4">
        <label for="inputName" translate>Group:</label>
        <select class="form-control" ng-options="group.id as group.name for group in groups" ng-model="user.groupId" required></select>
      </div>

      <div class="col-md-4" ng-show="canCreateAdmin()">
        <label>&nbsp;</label>
        <div class="checkbox">
          <label translate>
            <input type="checkbox" ng-model="user.isAdmin" i-check/> Is Admin?
          </label>
        </div>
      </div>

      <div class="col-md-4" ng-show="user.isAdmin">
        <label for="inputName" translate>
          Role:
          <i class="glyphicon glyphicon-question-sign"
             data-toggle="popover"
             data-placement="{{ isMobile ? 'top' : 'left'}}"
             data-trigger="click"
             title="Roles explanation"
             data-content='<b>Level 1 users have permission to:</b> <ol style="list-style-type: upper-roman;"> <li>Register new devices in the system;</li> <li>View realtime locations of officers;</li> <li>View history locations of officers and heatmaps;</li> <li>View realtime footage (no audio, only video);</li> </ol> <b>Level 2 users have permission to all of the above, plus:</b> <ol style="list-style-type: upper-roman;"> <li>View history footage (no audio, only video);</li> <li>Export redacted footage (no audio, only video; faces and vehicle licence plates are automatically blurred);</li> <li>Access to the CopCast Log Report;</li> <li>Create Level 1 users;</li> </ol> <b>Level 3 users also have permission to all of the above, plus:</b> <ol style="list-style-type: upper-roman;"> <li>Export of raw video footage;</li> <li>Create Level 2 users;</li> <li>Change data retention periods.</li> </ol>'></i>
        </label>
        <select class="form-control" ng-options="role  for role in roles" ng-model="user.role" ng-required="user.isAdmin"></select>
      </div>
    </div>

    <br>

    <div class="row">
      <div class="col-md-4">
        <label for="inputPassword" translate>Password:</label>
        <input type="password" class="form-control" id="inputPassword" ng-model="user.password" required ng-minlength="8"/>
        <meter max="5" id="password-strength-meter"></meter>
        <small translate>- Minimum 8 digits.</small>
        <span id="password-strength-text" class="pwdStrong"></span>
      </div>

      <!--<div class="col-md-4">-->
        <!--<p id="password-strength-text"></p>-->
      <!--</div>-->

      <div class="col-md-4">
        <label translate>Preferred language:</label>
        <div class="radio">
          <label class="radio-inline">
            <input type="radio" name="inlineRadioOptions" required value="pt_BR" ng-model="user.language" checked i-check>
            <img src="../assets/images/br-icon.png">
          </label>
          <label class="radio-inline">
            <input type="radio" name="inlineRadioOptions" required value="en" ng-model="user.language" i-check>
            <img src="../assets/images/us-icon.png">
          </label>
        </div>
      </div>
    </div>

    <hr class="hrDarker" />

    <div class="row">
      <div class="col-md-12">
        <a ng-click="back()" class="btn btn-default" translate>back</a>
        <button ng-disabled="frm.$invalid" ng-click="createNewUser()" class="btn btn-small btn-primary" translate>create new user</button>
      </div>
    </div>
  </form>
</div>

<script type="text/javascript">
  $(function () {
    setTimeout(function(){
      $('[data-toggle="popover"]')
        .popover({ container: 'body', html: true })
        .on('show.bs.popover', function(){ $(this).data('bs.popover').tip().css('max-width', '600px'); });
    }, 100);
  });

  var strength = {
    1: "Worst",
    2: "Bad",
    3: "Weak",
    4: "Good",
    5: "Strong"
  };

  var meter = $('#password-strength-meter');
  var text = $('#password-strength-text');
  text.hide();

  $('#inputPassword').keyup(function(){
    var $self = $(this);
    var password = $self.val();
    var result = zxcvbn(password);

    if (password !== "") {
      meter.val(result.score + 1);
      text.text(strength[result.score + 1]).fadeIn();
    } else {
      meter.val(0);
      text.fadeOut();
      setTimeout(function(){
        text.text("");
      }, 500);
    }
  });
</script>
